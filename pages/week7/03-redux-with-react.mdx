import { Alert } from "antd";

# 리덕스와 리액트

리덕스를 리액트와 함께 사용할때는 보통 일반적으로 다음 두 가지 라이브러리를 함께 사용합니다.

- [React Redux](https://react-redux.js.org): 리덕스를 리액트의 컴포넌트 방식으로 조합하여 사용할 수 있게 도와주는 라이브러리입니다.
- [Redux Toolkit](https://redux-toolkit.js.org/): 리덕스 각종 설정 및 번거로운 개발 과정을 간소화해주는 라이브러리입니다.

<br />
<br />

## 기본 사용법

최종 코드 결과물을 마지막에 보여드릴 예정이니, 우선 파트별 코드 내용을 1차적으로 살펴보고 최종 예시에서 종합적으로 자세히 살펴보시기 바랍니다.

<br />
<br />

### 1. 리덕스 스토어 생성하기

가장 먼저 우리 리덕스 상태관리를 위해 사용할 스토어를 생성해야 합니다. 리덕스 툴킷에서 편리하게 스토어와 리듀서 함수를 연결할 수 있는 보일러 플레이트를 아래와 같이 제공합니다. 아래 빈 객체에는 나중에 우리의 리듀서 함수를 추가할 공간입니다.

```js filename="app/store.js" showLineNumbers
import { configureStore } from "@reduxjs/toolkit";

export default configureStore({
  reducer: {
    // 리듀서 함수가 들어갈 자리
  },
});
```

<br />
<br />

### 2. 리덕스 스토어와 리액트 연결하기

리덕스 스토어에 새로운 상태가 업데이트 될때마다 리액트 컴포넌트들을 리렌더링(re-rendering)시켜야 합니다. 그렇기에, 리덕스 스토어와 리액트 컴포넌트를 연결해주어야 합니다.

`react-redux` 라이브러리는 `Provider`라는 컴포넌트를 통해 리덕스 스토어가 우리의 리액트 컴포넌트 트리와 연결될 수 있도록 합니다.

우리의 리액트 초기 렌더링 파일에 리덕스 스토어를 아래와 같이 연결합니다.

```js filename="index.js" {5, 6, 11} showLineNumbers
import React from "react";
import ReactDOM from "react-dom/client";
import "./index.css";
import App from "./App";
import store from "./app/store";
import { Provider } from "react-redux";

const root = ReactDOM.createRoot(document.getElementById("root"));

root.render(
  <Provider store={store}>
    <App />
  </Provider>
);
```

<br />
<br />

### 3. 리덕스 상태 슬라이스 생성하기

리덕스 툴킷은 슬라이스(slice)라는 방식을 통해 리덕스 보일러 플레이트를 단순화합니다.

우리의 리덕스 글로벌 상태는 여러 가지 관심사를 가질 수 있습니다. 슬라이스라는 단어는 피자의 조각을 뜻하는 의미와 같습니다. 우리 상태도 여러 조각으로 나뉘어 관리될 수 있고, 그 중 하나의 조각을 만들때 슬라이스를 이용해 생성할 수 있습니다.

```js filename="features/counter/counterSlice.js" showLineNumbers {4, 7, 12, 23, 26}
import { createSlice } from "@reduxjs/toolkit";

export const counterSlice = createSlice({
  // `name`은 액션 type의 이름으로 사용됩니다.
  name: "counter",

  // `initialState`는 초기 상태를 설정하는 부분입니다. 카운터 슬라이스 상태의 초기 상태값은 { value: 0 } 입니다.
  initialState: {
    value: 0,
  },

  // 카운터 상태를 관리하는 리듀서 함수들입니다.
  reducers: {
    increment: (state) => {
      state.value += 1;
    },
    incrementByAmount: (state, action) => {
      state.value += action.payload;
    },
  },
});

// 슬라이스를 통해 생성된 이 함수들을 통해 액션 객체를 생성해야만 합니다.
export const { increment, incrementByAmount } = counterSlice.actions;

// 리듀서를 export하여 리덕스 스토어에 주입해야 합니다.
export default counterSlice.reducer;
```

<br />
<br />

### 4. 스토어에 리듀서 추가하기

방금 생성한 리듀서 함수를 초기에 생성한 스토어에 추가해주어야 합니다.

```js filename="app/store.js" showLineNumbers
import { configureStore } from "@reduxjs/toolkit";
import counterReducer from "../features/counter/counterSlice";

export default configureStore({
  reducer: {
    // 전체 리덕스 스토어에서 카운터 슬라이스가 관리하는 상태에 접근하기 위한 속성값은 `counter`가 됩니다.
    counter: counterReducer
  },
});
```

<br />
<br />

이제 초기 설정은 끝났으며, 액션을 발생시키고 리덕스 상태를 업데이트하고 그에 따라 리렌더링을 발생시킬 수 있는 준비가 모두 완료되었습니다.

<br />
<br />

### 5. 액션 발생시키기

`react-redux`에서는 `useSelector`와 `useDispatch`라는 훅은 제공합니다. 우리는 이 훅들을 이용하여 액션을 발생시킬 수 있습니다.

1. "숫자 증가" 버튼을 클릭하면 `increment` 액션이 발생합니다.
2. 액션이 발생하면, 리듀서 함수가 실행됩니다.
3. 리듀서 함수에서 상태 변화를 연산합니다.
4. 스토어에 새로운 상태가 반영됩니다.
5. 새로운 상태값과 함께 컴포넌트 트리가 리렌더링 됩니다.

<br />

```js showLineNumbers { 1, 2, 5, 6, 11 } filename="features/counter/Counter.js"
import { useSelector, useDispatch } from "react-redux";
import { increment, incrementByAmount } from "./counterSlice";

export function Counter() {
  const count = useSelector((state) => state.counter.value);
  const dispatch = useDispatch();

  return (
    <div>
      <button
        onClick={() => dispatch(increment())}
      >
        숫자 증가
      </button>
      <span>{count}</span>
    </div>
  )
}
```

<br />
<br />

## `useSelector`

```jsx
const result: any = useSelector(selector: Function)
```

<br />

> `useSelector` 훅은 리덕스 스토어에서 우리가 원하는 상태값을 추출하여 사용할 수 있는 기능을 제공합니다.

<br />

### Selector function

`useSelector` 함수는 셀렉터(Selector) 함수라고 부르는 함수를 인자로 받습니다.

셀렉터 함수는 컴포넌트가 다시 렌더링 되는 과정에서 매번 실행되며, 셀렉터 함수는 전체 리덕스 스토어 상태 데이터를 인수로 전달 받습니다.

액션이 발생되면, `useSelector` 훅은 셀렉터 함수의 이전 결과값과 현재 결과값의 레퍼런스(참조)를 비교하고, 레퍼런스가 다를 경우 컴포넌트를 다시 렌더링합니다. 레퍼런스가 같을 경우, 다시 렌더링 하지 않습니다.

```js
const count = useSelector((state) => state.counter.value);
```

이전 단계에서 봤던 위와 같은 코드에서 `state`란 전체 리덕스 상태이며, `counter`라는 속성값을 통해 카운터 상태값에 접근합니다. `counter`라는 속성값으로 접근해야 하는 이유는, `app/store.js`에서 설정한 리듀서 객체 내부에 `counter`라는 속성 이름을 설정했기 때문입니다.

`state.counter` 상태에 이어 `.value`라는 키값으로 또 다시 상태값을 접근하는 이유는, 카운터 슬라이스 내부에서 초기 상태값을 `value`라는 속성값으로 설정했기 때문입니다.

<br />
<br />

## `useDispatch`

```jsx
const dispatch = useDispatch();
```

이 훅은 난해한 부분은 크게 없습니다. `useDispatch` 는 리덕스 스토어에게 새로운 소식(액션)을 전달할 수 있는 특별한 능력이 있는 `dispatch`라는 함수를 반환합니다. 여러분은 이 함수를 이용하여 액션을 발생시킬 수 있습니다.

<br />
<br />

## 최종 결과물

지금까지 위에서 설명드렸던 최종 결과물이 담겨있는 코드입니다. 또한 여러분께서 시도해볼 수 있는 간단한 실습 예제가 있으니, 반드시 시도해보세요.

(Open Sandbox를 이용하시면 더 큰 창에서 보실 수 있습니다.)

<br />

<iframe src="https://codesandbox.io/embed/10-react-redux-forked-4dxcy9?fontsize=14&hidenavigation=1&theme=light"
  style={{ width: "100%", height:"500px", border:0, borderRadius: "4px", overflow:"hidden" }}
  title="React Redux"
  allow="accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr; xr-spatial-tracking"
  sandbox="allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts"
></iframe>
