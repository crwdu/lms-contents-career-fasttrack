import { Alert } from "antd";
import { Callout } from "nextra-theme-docs";

# CORS 정책

CORS(Cross Origin Resource Sharing)은 브라우저가 보안을 위해 규제하는 정책입니다. CORS는 한 도메인에서 다른 도메인에 있는 리소스와 상호 작용하는 클라이언트 웹 어플리케이션에 대한 규제입니다. 예를 들어, 여러분께서 Github에서 여러분의 데이터를 가져와 사용하거나, 정부 API를 사용하여 국가 정보를 이용한 어플리케이션을 구축하는 경우 등이 포함될 수 있습니다.

인터넷 기술이 여전히 많이 발달하지 않았던 과거에는 크로스 사이트 요청 위조(CSRF) 문제가 발생했습니다. CSRF 해킹은 피해자의 브라우저에서 다른 웹 어플리케이션으로 가짜 클라이언트 요청을 전송합니다.

예를 들어, 피해자가 은행 어플리케이션에 로그인하면 피해자를 속여 새 브라우저 탭에서 외부 웹 사이트를 실행합니다. 이 외부 웹 사이트는 피해자의 쿠키 보안 인증 정보를 사용하고 데이터를 연동하여 마치 피해자인 것처럼 가장하여 은행 어플리케이션에 피해자 데이터를 전달합니다. 그러면 권한이 없는 해커에게 은행 어플리케이션에 대한 접근 권한이 의도치 않게 부여됩니다.

이러한 CSRF 문제를 방지하기 위해 현재는 모든 브라우저에서는 기본적으로 **동일 출처 정책**이 적용되어 있습니다.

> 우리는 해킹을 학습하는 것이 아니기 때문에, 구체적으로 CSRF 해킹 방법에 대해 깊이 이해할 필요는 없습니다.

<br />
<br />

## 동일 출처 정책

최신 브라우저에서는 클라이언트가 클라이언트의 URL과 동일한 출처의 리소스로만 요청을 보낼 수 있습니다. 클라이언트 URL의 프로토콜, 포트 및 호스트 이름은 모두 클라이언트에서 요청하는 서버와 일치해야 합니다.

예를 들어, 아래 URL의 출처와 클라이언트 URL `http://www.vanillacoding.co` 의 출처를 비교해 보세요.

- `http://www.vanillacoding.co/hello-world`: 동일한 출처
- `https://www.vanillacoding.co/hello-world`: 다른 출처
- `http://cool.vanillacoding.co/course`: 다른 출처

<br />
<br />

## CORS의 작동 원리

인터넷 통신에서 브라우저는 어플리케이션 서버에 HTTP 요청을 보내고 HTTP 응답으로 데이터를 수신하여 화면에 표시합니다. 브라우저 용어에서는 현재 브라우저 URL을 현재 오리진(출처)이라고 하고 외부 URL을 크로스 오리진(외부 출처)이라고 합니다. 크로스 오리진 요청을 할 때 요청과 응답의 프로세스는 다음과 같습니다.

1. 브라우저는 현재 오리진의 프로토콜, 호스트 등에 대한 정보가 포함된 오리진 헤더를 요청에 추가합니다.
2. 서버는 현재 오리진 헤더를 확인하고 요청된 데이터와 Access-Control-Allow-Origin 헤더(액세스 제어 요청 헤더)로 응답합니다.
3. 브라우저는 액세스 제어 요청 헤더를 확인한 후, 서버로부터 전달받은 데이터를 클라이언트 어플리케이션과 공유합니다.
4. 서버에서 크로스 오리진 액세스를 허용하지 않는 경우에는 오류 메시지로 응답합니다.

<br />
<br />

## CORS 사전요청

외부 출처를 향한 요청 중 일부 HTTP 요청은 복잡한 것으로 간주되기 때문에 실제 요청을 보내기 전에 서버 측의 사전 확인 절차가 필요합니다. 이 사전 승인 프로세스를 사전 요청(Preflight request)이라고 합니다.

<br />
<br />

![CORS 사전요청](./assets/cors/preflight.png)

<br />
<br />

### 사전요청이 사용되는 경우

다음 중 하나라도 충족한다면, 브라우저에서는 사전요청을 서버에게 전송합니다.

1. GET, POST 또는 HEAD 외의 메서드가 사용되는 경우
2. Accept-Language, Accept 또는 Content-Language 외의 헤더가 사용되는 경우
3. multipart/form-data, application/x-www-form-urlencoded 또는 text/plain 외의 Content-Type 헤더가 사용되는 경우

사전요청은 항상 OPTIONS라는 HTTP 메소드를 이용해 서버에게 전달되며, 여러분께서 개발자 도구를 활용해 직접 확인할 수 있습니다. 이 사전요청에서 성공에 대한 응답이 서버로부터 전송되어야만, 실제 CORS 요청이 서버로 전송될 수 있습니다.

<br />
<br />

### 마무리

CORS 정책은 채용 인터뷰 과정에서도 단골 질문이고, 실제로 이에 대한 이해도가 없다면 기본적인 프론트엔드/백엔드 등의 웹 어플리케이션 작업은 불가능에 가깝다 할 수 있을 정도로 중요한 개념입니다. 반드시 깊이 이해하고 관련 상황에 대응할 수 있는 능력이 필요합니다.

<br />

#### 퀴즈

여러분께서 작업하는 프론트엔드 프로젝트에서 `http://api.something.com/big-data`이라는 서버에 있는 데이터를 활용하여 시각화하고 싶습니다. 그래서 요청을 보냈더니, CORS 정책을 위배했다는 오류가 발생했습니다. `http://api.something.com/big-data` 서버는 여러분이 소유하지 않았고, 이 서버에 대한 제어를 여러분이 전혀 할 수 없는 상황이라고 가정할때, 여러분께서 저 서버의 데이터를 사용하기 위해 CORS 정책 이슈를 해결할 수 있는 방법은 무엇이 있을까요?
